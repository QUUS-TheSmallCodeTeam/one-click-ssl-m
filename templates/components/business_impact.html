<!-- Business Impact Analysis 컴포넌트 -->
<section class="business-impact">
    <h2>💰 비즈니스 영향 분석</h2>

    <!-- 매출 손실 계산 -->
    <div class="revenue-loss-analysis">
        <h3>💸 매출 손실 계산</h3>
        <div class="calculation-container">
            <div class="calculation-model">
                <h4>{{ industry_display }} 업종 분석 모델</h4>
                <div class="model-assumptions">
                    <div class="assumption-item">
                        <strong>추정 월 방문자:</strong> <span>{{ "{:,}".format(monthly_visitors) }}명</span>
                    </div>
                    <div class="assumption-item">
                        <strong>SSL 문제 이탈률:</strong> <span class="loss-rate">{{ "%.0f"|format(user_loss_rate) }}%</span>
                    </div>
                    <div class="assumption-item">
                        <strong>실제 유효 방문자:</strong> <span>{{ "{:,}".format(effective_visitors) }}명</span>
                    </div>
                    <div class="assumption-item">
                        <strong>{{ conversion_type }} 전환율:</strong> <span>{{ "%.1f"|format(conversion_rate * 100) }}%</span>
                    </div>
                    {% if industry == 'manufacturing' %}
                    <div class="assumption-item">
                        <strong>수주 전환율:</strong> <span>{{ "%.0f"|format(order_conversion_rate * 100) }}%</span>
                    </div>
                    {% endif %}
                    <div class="assumption-item">
                        <strong>{{ value_type }}:</strong> <span>{{ format_currency(average_value) }}</span>
                    </div>
                </div>
            </div>
            
            <div class="loss-calculation">
                <h4>손실 계산 과정</h4>
                <div class="calc-steps">
                    <div class="calc-step">
                        <div class="calc-formula">{{ "{:,}".format(monthly_visitors) }}명 × {{ "%.0f"|format(user_loss_rate) }}%</div>
                        <div class="calc-result">= {{ "{:,}".format(lost_users_monthly) }}명 손실/월</div>
                    </div>
                    <div class="calc-step">
                        <div class="calc-formula">{{ "{:,}".format(lost_users_monthly) }}명 × {{ "%.1f"|format(conversion_rate * 100) }}%</div>
                        <div class="calc-result">= {{ "{:,}".format(lost_conversions) }}건 전환 손실</div>
                    </div>
                    {% if industry == 'manufacturing' %}
                    <div class="calc-step">
                        <div class="calc-formula">{{ "{:,}".format(lost_conversions) }}건 × {{ "%.0f"|format(order_conversion_rate * 100) }}%</div>
                        <div class="calc-result">= {{ "{:,}".format(lost_orders) }}건 수주 손실</div>
                    </div>
                    <div class="calc-step">
                        <div class="calc-formula">{{ "{:,}".format(lost_orders) }}건 × {{ format_currency(average_value) }}</div>
                        <div class="calc-result">= {{ format_currency(monthly_loss) }}/월 손실</div>
                    </div>
                    {% else %}
                    <div class="calc-step">
                        <div class="calc-formula">{{ "{:,}".format(lost_conversions) }}건 × {{ format_currency(average_value) }}</div>
                        <div class="calc-result">= {{ format_currency(monthly_loss) }}/월 손실</div>
                    </div>
                    {% endif %}
                    <div class="calc-step final-calc">
                        <div class="calc-formula">{{ format_currency(monthly_loss) }}/월 × 12개월</div>
                        <div class="calc-result highlight">= {{ format_currency(annual_loss) }}/년 손실</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 손실 임팩트 시각화 -->
        <div class="loss-visualization">
            <div class="loss-timeline">
                <h4>⏰ 시간별 누적 손실</h4>
                <div class="timeline-items">
                    <div class="timeline-item">
                        <span class="time-label">1시간</span>
                        <span class="loss-amount">{{ format_currency(hourly_loss) }}</span>
                    </div>
                    <div class="timeline-item">
                        <span class="time-label">1일</span>
                        <span class="loss-amount">{{ format_currency(daily_loss) }}</span>
                    </div>
                    <div class="timeline-item">
                        <span class="time-label">1주일</span>
                        <span class="loss-amount">{{ format_currency(weekly_loss) }}</span>
                    </div>
                    <div class="timeline-item highlight">
                        <span class="time-label">1개월</span>
                        <span class="loss-amount">{{ format_currency(monthly_loss) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SEO 및 검색 영향 -->
    <div class="seo-impact-analysis">
        <h3>📈 SEO 및 검색 순위 영향</h3>
        <div class="seo-factors">
            <div class="seo-factor">
                <div class="factor-icon">🔍</div>
                <div class="factor-content">
                    <h4>Google 검색 알고리즘 패널티</h4>
                    <div class="factor-details">
                        <div class="detail-row">
                            <strong>HTTPS 랭킹 팩터:</strong> 
                            <span class="{% if ssl_case_type == 'valid' %}positive{% else %}negative{% endif %}">
                                {% if ssl_case_type == 'valid' %}✓ 가산점{% else %}✗ 감점{% endif %}
                            </span>
                        </div>
                        <div class="detail-row">
                            <strong>예상 순위 변화:</strong> 
                            <span class="rank-change {{ 'positive' if ssl_case_type == 'valid' else 'negative' }}">
                                {% if ssl_case_type == 'valid' %}+{{ seo_boost }}%{% else %}-{{ seo_penalty }}%{% endif %}
                            </span>
                        </div>
                        <div class="detail-row">
                            <strong>유기적 트래픽 영향:</strong>
                            <span class="traffic-change {{ 'positive' if ssl_case_type == 'valid' else 'negative' }}">
                                {% if ssl_case_type == 'valid' %}+{{ organic_traffic_boost }}%{% else %}-{{ organic_traffic_loss }}%{% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="seo-factor">
                <div class="factor-icon">📱</div>
                <div class="factor-content">
                    <h4>모바일 퍼스트 인덱싱 영향</h4>
                    <div class="factor-details">
                        <div class="detail-row">
                            <strong>모바일 트래픽 비중:</strong> <span>{{ mobile_traffic_ratio }}%</span>
                        </div>
                        <div class="detail-row">
                            <strong>모바일 보안 경고:</strong> 
                            <span class="{% if ssl_case_type in ['no_ssl', 'self_signed'] %}severe{% else %}normal{% endif %}">
                                {% if ssl_case_type in ['no_ssl', 'self_signed'] %}더 엄격한 차단{% else %}정상{% endif %}
                            </span>
                        </div>
                        <div class="detail-row">
                            <strong>모바일 이탈률:</strong> 
                            <span class="mobile-loss">{{ "%.0f"|format(mobile_loss_rate) }}%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 브랜드 신뢰도 분석 -->
    <div class="brand-trust-analysis">
        <h3>🏢 브랜드 신뢰도 영향</h3>
        <div class="trust-metrics">
            <div class="trust-category">
                <h4>고객 신뢰도 손상</h4>
                <div class="trust-gauge">
                    <div class="gauge-container">
                        <div class="gauge-fill" style="width: {{ trust_damage_percentage }}%; background-color: {{ trust_damage_color }};"></div>
                    </div>
                    <span class="gauge-label">{{ "%.0f"|format(trust_damage_percentage) }}% 신뢰도 손상</span>
                </div>
                <div class="trust-factors">
                    {% for factor in trust_damage_factors %}
                    <div class="trust-factor-item">
                        <span class="factor-impact">{{ factor.impact }}</span>
                        <span class="factor-description">{{ factor.description }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="trust-recovery">
                <h4>신뢰도 회복 시간</h4>
                <div class="recovery-timeline">
                    <div class="recovery-item">
                        <strong>즉시 개선:</strong> 
                        <span>보안 경고 제거 (당일)</span>
                    </div>
                    <div class="recovery-item">
                        <strong>단기 회복:</strong> 
                        <span>사용자 경험 개선 (1-2주)</span>
                    </div>
                    <div class="recovery-item">
                        <strong>완전 회복:</strong> 
                        <span>브랜드 이미지 안정화 ({{ trust_recovery_months }}개월)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 경쟁사 비교 분석 -->
    <div class="competitive-analysis">
        <h3>📊 {{ industry_display }} 업계 경쟁사 대비 현황</h3>
        <div class="competitor-table-container">
            <table class="competitor-table">
                <thead>
                    <tr>
                        <th>회사명</th>
                        <th>SSL 등급</th>
                        <th>보안 점수</th>
                        <th>브랜드 신뢰도</th>
                        <th>상태</th>
                    </tr>
                </thead>
                <tbody>
                    {% for competitor in competitors %}
                    <tr class="competitor-row">
                        <td>{{ competitor.name }}</td>
                        <td>
                            <span class="grade grade-{{ competitor.grade_class }}">{{ competitor.ssl_grade }}</span>
                        </td>
                        <td class="score-cell">{{ competitor.security_score }}/100</td>
                        <td class="trust-cell">
                            <div class="trust-mini-gauge">
                                <div class="mini-gauge-fill" style="width: {{ competitor.trust_score }}%;"></div>
                            </div>
                            <span>{{ competitor.trust_score }}%</span>
                        </td>
                        <td class="status-{{ competitor.status }}">{{ competitor.status_text }}</td>
                    </tr>
                    {% endfor %}
                    
                    <!-- 현재 사이트 -->
                    <tr class="current-site-row">
                        <td><strong>{{ domain }}</strong> (현재)</td>
                        <td>
                            <span class="grade grade-{{ grade_class }}">{{ security_grade }}</span>
                        </td>
                        <td class="score-cell"><strong>{{ security_score }}/100</strong></td>
                        <td class="trust-cell">
                            <div class="trust-mini-gauge">
                                <div class="mini-gauge-fill critical" style="width: {{ current_trust_score }}%;"></div>
                            </div>
                            <span><strong>{{ current_trust_score }}%</strong></span>
                        </td>
                        <td class="status-{{ current_status }}"><strong>{{ current_status_text }}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- 경쟁 우위 분석 -->
        <div class="competitive-gap-analysis">
            <h4>경쟁사 대비 격차 분석</h4>
            <div class="gap-metrics">
                <div class="gap-item">
                    <strong>평균 대비 보안 점수:</strong>
                    <span class="gap-score {{ 'positive' if security_gap > 0 else 'negative' }}">
                        {{ "+" if security_gap > 0 else "" }}{{ security_gap }}점
                    </span>
                </div>
                <div class="gap-item">
                    <strong>업계 상위 대비:</strong>
                    <span class="gap-score negative">-{{ industry_leader_gap }}점</span>
                </div>
                <div class="gap-item">
                    <strong>추격 필요 시간:</strong>
                    <span class="catch-up-time">{{ catch_up_time }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 고객 행동 영향 분석 -->
    <div class="customer-behavior-analysis">
        <h3>👥 고객 행동 영향 분석</h3>
        <div class="behavior-scenarios">
            {% for scenario in customer_scenarios %}
            <div class="scenario-card">
                <div class="scenario-header">
                    <h4>{{ scenario.customer_type }}</h4>
                    <span class="scenario-percentage">{{ "%.0f"|format(scenario.percentage) }}%</span>
                </div>
                <div class="scenario-content">
                    <div class="behavior-flow">
                        {% for step in scenario.behavior_steps %}
                        <div class="behavior-step">
                            <span class="step-number">{{ loop.index }}</span>
                            <span class="step-description">{{ step.description }}</span>
                            <span class="step-outcome {{ step.outcome_class }}">{{ step.outcome }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="scenario-impact">
                        <strong>예상 이탈률:</strong> <span class="impact-percentage">{{ "%.0f"|format(scenario.churn_rate) }}%</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- 법적/규제 리스크 -->
    <div class="legal-compliance-risk">
        <h3>⚖️ 법적 규제 준수 리스크</h3>
        <div class="compliance-grid">
            {% for regulation in legal_regulations %}
            <div class="regulation-item {{ regulation.compliance_status }}">
                <div class="regulation-header">
                    <h4>{{ regulation.name }}</h4>
                    <span class="compliance-badge {{ regulation.compliance_status }}">
                        {{ regulation.compliance_text }}
                    </span>
                </div>
                <div class="regulation-content">
                    <p><strong>요구사항:</strong> {{ regulation.requirement }}</p>
                    <p><strong>현재 준수 상태:</strong> {{ regulation.current_status }}</p>
                    {% if regulation.penalty %}
                    <div class="penalty-info">
                        <strong>위반시 과태료:</strong> <span class="penalty-amount">{{ regulation.penalty }}</span>
                    </div>
                    {% endif %}
                    {% if regulation.compliance_status == 'non-compliant' %}
                    <div class="action-required">
                        <strong>필요 조치:</strong> {{ regulation.required_action }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- 마케팅 영향 분석 -->
    <div class="marketing-impact">
        <h3>📢 마케팅 활동 영향</h3>
        <div class="marketing-channels">
            {% for channel in marketing_channels %}
            <div class="channel-impact">
                <h4>{{ channel.name }}</h4>
                <div class="impact-details">
                    <div class="impact-item">
                        <strong>현재 효과:</strong> 
                        <span class="effectiveness {{ channel.current_effectiveness_class }}">
                            {{ channel.current_effectiveness }}
                        </span>
                    </div>
                    <div class="impact-item">
                        <strong>SSL 개선 후:</strong>
                        <span class="effectiveness improved">{{ channel.improved_effectiveness }}</span>
                    </div>
                    <div class="impact-item">
                        <strong>예상 개선:</strong>
                        <span class="improvement">+{{ channel.improvement_percentage }}%</span>
                    </div>
                </div>
                {% if channel.specific_issues %}
                <div class="channel-issues">
                    <strong>특별 고려사항:</strong>
                    <ul>
                        {% for issue in channel.specific_issues %}
                        <li>{{ issue }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<style>
/* Business Impact 스타일 */
.business-impact {
    margin-bottom: 30px;
}

/* 매출 손실 계산 */
.calculation-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 15px;
    margin-bottom: 25px;
}

.calculation-model, .loss-calculation {
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.calculation-model h4, .loss-calculation h4 {
    margin: 0 0 15px 0;
    color: #495057;
    font-size: 14px;
    font-weight: bold;
}

.model-assumptions {
    margin-bottom: 15px;
}

.assumption-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #dee2e6;
    font-size: 12px;
}

.assumption-item:last-child {
    border-bottom: none;
}

.loss-rate {
    color: #dc3545;
    font-weight: bold;
}

/* 계산 과정 */
.calc-steps {
    margin-top: 10px;
}

.calc-step {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #dee2e6;
    font-size: 12px;
}

.calc-step:last-child {
    border-bottom: none;
}

.calc-step.final-calc {
    margin-top: 10px;
    padding-top: 15px;
    border-top: 2px solid #007bff;
    font-weight: bold;
}

.calc-formula {
    color: #495057;
}

.calc-result {
    font-weight: bold;
    color: #333;
}

.calc-result.highlight {
    color: #dc3545;
    font-size: 14px;
}

/* 손실 시각화 */
.loss-visualization {
    margin-top: 25px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.timeline-items {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
}

.timeline-item {
    text-align: center;
    padding: 15px;
    border-radius: 6px;
    background-color: #f8f9fa;
    min-width: 100px;
}

.timeline-item.highlight {
    background-color: #fff3cd;
    border: 1px solid #ffeaa7;
}

.time-label {
    display: block;
    font-size: 11px;
    color: #6c757d;
    margin-bottom: 8px;
    font-weight: bold;
}

.loss-amount {
    display: block;
    font-size: 14px;
    font-weight: bold;
    color: #dc3545;
}

/* SEO 영향 */
.seo-factors {
    margin-top: 15px;
}

.seo-factor {
    display: flex;
    align-items: flex-start;
    padding: 20px;
    background: white;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    margin-bottom: 15px;
}

.factor-icon {
    font-size: 24px;
    margin-right: 15px;
    flex-shrink: 0;
}

.factor-content {
    flex: 1;
}

.factor-content h4 {
    margin: 0 0 12px 0;
    font-size: 14px;
    font-weight: bold;
    color: #333;
}

.factor-details {
    margin-top: 10px;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid #f1f3f4;
    font-size: 12px;
}

.detail-row:last-child {
    border-bottom: none;
}

.positive {
    color: #28a745;
    font-weight: bold;
}

.negative {
    color: #dc3545;
    font-weight: bold;
}

.rank-change, .traffic-change {
    font-weight: bold;
}

/* 브랜드 신뢰도 */
.trust-metrics {
    margin-top: 15px;
}

.trust-category {
    padding: 20px;
    background: white;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    margin-bottom: 20px;
}

.trust-gauge {
    margin: 15px 0;
}

.gauge-container {
    width: 100%;
    height: 12px;
    background-color: #e9ecef;
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 8px;
}

.gauge-fill {
    height: 100%;
    transition: width 0.5s ease;
}

.gauge-label {
    font-size: 12px;
    font-weight: bold;
}

.trust-factors {
    margin-top: 15px;
}

.trust-factor-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #f1f3f4;
    font-size: 12px;
}

.trust-factor-item:last-child {
    border-bottom: none;
}

.factor-impact {
    color: #dc3545;
    font-weight: bold;
}

/* 경쟁사 테이블 */
.competitor-table-container {
    margin-top: 15px;
    overflow-x: auto;
}

.competitor-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #e9ecef;
}

.competitor-table th {
    background-color: #007bff;
    color: white;
    padding: 12px;
    text-align: left;
    font-weight: bold;
    font-size: 11px;
}

.competitor-table td {
    padding: 12px;
    border-bottom: 1px solid #f1f3f4;
}

.competitor-row:hover {
    background-color: #f8f9fa;
}

.current-site-row {
    background-color: #fff3cd;
    font-weight: bold;
}

.score-cell, .trust-cell {
    text-align: center;
}

.trust-mini-gauge {
    width: 60px;
    height: 6px;
    background-color: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
    margin: 0 auto 5px auto;
}

.mini-gauge-fill {
    height: 100%;
    background-color: #28a745;
}

.mini-gauge-fill.critical {
    background-color: #dc3545;
}

/* 규제 준수 */
.compliance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.regulation-item {
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.regulation-item.compliant {
    background-color: #d4edda;
    border-color: #c3e6cb;
}

.regulation-item.non-compliant {
    background-color: #f8d7da;
    border-color: #f5c6cb;
}

.regulation-item.partial {
    background-color: #fff3cd;
    border-color: #ffeaa7;
}

.regulation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.regulation-header h4 {
    margin: 0;
    font-size: 14px;
    font-weight: bold;
}

.compliance-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: bold;
    text-transform: uppercase;
}

.compliance-badge.compliant {
    background-color: #28a745;
    color: white;
}

.compliance-badge.non-compliant {
    background-color: #dc3545;
    color: white;
}

.compliance-badge.partial {
    background-color: #ffc107;
    color: #000;
}

.regulation-content p {
    margin: 0 0 8px 0;
    font-size: 12px;
    line-height: 1.4;
}

.penalty-info, .action-required {
    margin-top: 12px;
    padding: 10px;
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 4px;
    font-size: 11px;
}

.penalty-amount {
    color: #dc3545;
    font-weight: bold;
}

/* 마케팅 영향 */
.marketing-channels {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.channel-impact {
    padding: 20px;
    background: white;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.channel-impact h4 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 14px;
    font-weight: bold;
}

.impact-details {
    margin-bottom: 15px;
}

.impact-item {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    font-size: 12px;
    border-bottom: 1px solid #f1f3f4;
}

.impact-item:last-child {
    border-bottom: none;
}

.effectiveness {
    font-weight: bold;
}

.effectiveness.low {
    color: #dc3545;
}

.effectiveness.medium {
    color: #ffc107;
}

.effectiveness.high {
    color: #28a745;
}

.effectiveness.improved {
    color: #17a2b8;
}

.improvement {
    color: #28a745;
    font-weight: bold;
}

.channel-issues {
    margin-top: 12px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
    font-size: 11px;
}

.channel-issues ul {
    margin: 5px 0 0 0;
    padding-left: 15px;
}

.channel-issues li {
    margin-bottom: 3px;
    line-height: 1.3;
}

/* 반응형 */
@media print {
    .calculation-container {
        grid-template-columns: 1fr;
    }
    
    .timeline-items {
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .marketing-channels, .compliance-grid {
        grid-template-columns: 1fr;
    }
}

@media screen and (max-width: 768px) {
    .calculation-container {
        grid-template-columns: 1fr;
    }
    
    .timeline-items {
        flex-direction: column;
        gap: 10px;
    }
    
    .competitor-table {
        font-size: 10px;
    }
    
    .competitor-table th,
    .competitor-table td {
        padding: 8px;
    }
}
</style>