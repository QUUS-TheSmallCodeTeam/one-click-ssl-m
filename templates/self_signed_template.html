{% extends "base_template.html" %}

{% block executive_summary %}
<section class="executive-summary">
    <h2>📋 경영진 요약</h2>
    
    <div class="alert alert-warning">
        <div class="alert-icon">⚠️</div>
        <div class="alert-content">
            <h3>자체 서명 인증서 + 서버 설정 문제 발견</h3>
            <p><strong>{{ domain }}</strong> 웹사이트가 자체 서명 인증서를 사용하고 있어 브라우저 보안 경고가 표시됩니다.
            {% if has_server_error %}또한 HTTPS 접속 시 서버 오류({{ http_status_code }})가 발생하여 서비스가 정상 작동하지 않습니다.{% endif %}</p>
        </div>
    </div>

    {% if has_server_error %}
    <div class="alert alert-critical">
        <div class="alert-icon">🚨</div>
        <div class="alert-content">
            <h3>추가 발견: 심각한 서버 설정 문제</h3>
            <p><strong>HTTP {{ http_status_code }} 오류</strong>로 인해 HTTPS 서비스가 완전히 중단된 상태입니다. 
               SSL 인증서 교체 전에 서버 설정 문제를 우선 해결해야 합니다.</p>
        </div>
    </div>
    {% endif %}

    <div class="impact-metrics">
        <h4>비즈니스 영향 지표</h4>
        <div class="metrics-grid">
            <div class="metric-card {{ 'critical' if has_server_error else 'warning' }}">
                <div class="metric-number">{{ "%.0f"|format(user_loss_rate) }}%</div>
                <div class="metric-label">예상 사용자 이탈률</div>
                <div class="metric-detail">{{ "{:,}".format(lost_users_daily) }}명/일 손실</div>
            </div>
            
            <div class="metric-card {{ 'critical' if has_server_error else 'warning' }}">
                <div class="metric-number">{{ format_currency(annual_loss) }}</div>
                <div class="metric-label">연간 예상 손실</div>
                <div class="metric-detail">{{ format_currency(monthly_loss) }}/월</div>
            </div>
            
            <div class="metric-card warning">
                <div class="metric-number">-{{ "%.0f"|format(seo_penalty) }}%</div>
                <div class="metric-label">검색 순위 영향</div>
                <div class="metric-detail">브랜드 검색 하락</div>
            </div>
            
            <div class="metric-card warning">
                <div class="metric-number">{{ "%.0f"|format(trust_damage) }}%</div>
                <div class="metric-label">브랜드 신뢰도 손상</div>
                <div class="metric-detail">{{ trust_recovery_time }} 회복 필요</div>
            </div>
        </div>
    </div>

    <div class="urgent-actions">
        <h4>🎯 즉시 조치사항 (우선순위별)</h4>
        <div class="actions-timeline">
            {% if has_server_error %}
            <div class="action-item priority-critical">
                <div class="action-timeline">
                    <div class="action-time">즉시</div>
                    <div class="action-priority-badge">최우선</div>
                </div>
                <div class="action-content">
                    <h5>서버 오류 수정 ({{ http_status_code }} 에러)</h5>
                    <p>HTTPS 서비스를 먼저 정상 작동시킨 후 SSL 인증서를 교체해야 합니다.</p>
                    <div class="expected-impact">
                        <strong>예상 효과:</strong> HTTPS 접속 가능, 서비스 정상화
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="action-item priority-critical">
                <div class="action-timeline">
                    <div class="action-time">{{ '당일' if not has_server_error else '1-2일' }}</div>
                    <div class="action-priority-badge">긴급</div>
                </div>
                <div class="action-content">
                    <h5>정식 CA 발급 SSL 인증서로 교체</h5>
                    <p>자체 서명 인증서를 Let's Encrypt 무료 SSL로 교체하여 브라우저 신뢰를 확보하세요.</p>
                    <div class="expected-impact">
                        <strong>예상 효과:</strong> 보안 등급 D → B+, 브라우저 경고 완전 제거
                    </div>
                </div>
            </div>
            
            <div class="action-item priority-high">
                <div class="action-timeline">
                    <div class="action-time">1주일</div>
                    <div class="action-priority-badge">높음</div>
                </div>
                <div class="action-content">
                    <h5>보안 헤더 및 HTTPS 리다이렉션 설정</h5>
                    <p>SSL Labs A등급 달성과 완전한 보안 체계 구축으로 업계 표준에 부합하세요.</p>
                    <div class="expected-impact">
                        <strong>예상 효과:</strong> 월 매출 {{ format_currency(monthly_recovery) }} 회복
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block technical_analysis %}
<section class="technical-analysis">
    <h2>🔍 상세 기술 분석</h2>

    <!-- 현재 SSL 인증서 분석 -->
    <div class="ssl-status-analysis">
        <h3>현재 SSL 인증서 상태</h3>
        
        <div class="analysis-result result-warning">
            <div class="result-icon">⚠️</div>
            <div class="result-content">
                <h4>자체 서명 인증서 사용 중</h4>
                <p><strong>문제점:</strong> 브라우저가 신뢰하지 않는 자체 발급 인증서 사용</p>
                
                <div class="certificate-details">
                    <h5>인증서 상세 정보</h5>
                    <div class="cert-info-grid">
                        <div class="cert-field">
                            <strong>발급 대상 (Subject):</strong>
                            <span>{{ cert_subject }}</span>
                        </div>
                        <div class="cert-field">
                            <strong>발급자 (Issuer):</strong>
                            <span class="self-signed-indicator">{{ cert_issuer }}</span>
                        </div>
                        <div class="cert-field critical">
                            <strong>자체 서명 여부:</strong>
                            <span class="status-warning">✓ Subject = Issuer (자기가 자기 인증)</span>
                        </div>
                        <div class="cert-field">
                            <strong>유효 기간:</strong>
                            <span>{{ cert_valid_from }} ~ {{ cert_valid_to }}</span>
                        </div>
                        {% if cert_duration_years > 10 %}
                        <div class="cert-field suspicious">
                            <strong>⚠️ 의심스러운 유효기간:</strong>
                            <span>{{ cert_duration_years }}년 (일반적으로 1-2년)</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="self_signed_risks">
                    <h5>자체 서명 인증서의 위험성</h5>
                    <div class="risk-items">
                        <div class="risk-item high">
                            <strong>중간자 공격(MITM) 취약:</strong> 공격자가 가짜 인증서로 트래픽 가로채기 가능
                        </div>
                        <div class="risk-item high">
                            <strong>신원 확인 불가:</strong> 해당 도메인의 실제 소유자인지 확인 불가
                        </div>
                        <div class="risk-item medium">
                            <strong>브라우저 경고:</strong> 모든 주요 브라우저에서 경고 메시지 표시
                        </div>
                        <div class="risk-item medium">
                            <strong>전문성 의심:</strong> 기술 회사임에도 기본 보안 미흡으로 인식
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if has_server_error %}
        <!-- 서버 오류 분석 -->
        <div class="analysis-result result-critical">
            <div class="result-icon">💥</div>
            <div class="result-content">
                <h4>심각한 서버 설정 문제</h4>
                <p><strong>HTTP {{ http_status_code }} {{ http_status_message }}</strong></p>
                
                <div class="server-error-analysis">
                    {% if http_status_code == 406 %}
                    <div class="error-details">
                        <h5>406 Not Acceptable 상세 분석</h5>
                        <div class="error-explanation">
                            <p><strong>원인:</strong> 서버가 클라이언트의 Accept 헤더를 처리하지 못하고 있습니다.</p>
                            <p><strong>가능한 원인들:</strong></p>
                            <ul>
                                <li>nginx 프록시 설정에서 Accept 헤더 누락</li>
                                <li>백엔드 PHP 애플리케이션의 HTTPS 환경 처리 오류</li>
                                <li>SSL Termination 설정 문제</li>
                                <li>Content-Type 협상 실패</li>
                            </ul>
                        </div>
                        
                        <div class="technical-diagnosis">
                            <h6>기술적 진단 결과:</h6>
                            <div class="diagnosis-item">
                                <strong>HTTP 접속:</strong> <span class="status-success">정상 (200 OK)</span>
                            </div>
                            <div class="diagnosis-item">
                                <strong>HTTPS 접속:</strong> <span class="status-failed">406 Not Acceptable</span>
                            </div>
                            <div class="diagnosis-item">
                                <strong>SSL 핸드셰이크:</strong> <span class="status-success">성공 (자체 서명)</span>
                            </div>
                            <div class="diagnosis-item">
                                <strong>애플리케이션 레이어:</strong> <span class="status-failed">요청 거부</span>
                            </div>
                        </div>
                    </div>
                    {% elif http_status_code >= 500 %}
                    <div class="error-details">
                        <h5>{{ http_status_code }} 서버 내부 오류</h5>
                        <p>HTTPS 환경에서 서버 애플리케이션이 정상 작동하지 않고 있습니다.</p>
                        <div class="server-diagnosis">
                            <ul>
                                <li>웹서버 설정 파일 문법 오류 가능성</li>
                                <li>SSL 관련 모듈 설정 문제</li>
                                <li>백엔드 애플리케이션 HTTPS 처리 오류</li>
                                <li>프록시 패스 설정 문제</li>
                            </ul>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- 브라우저별 경고 상황 -->
    <div class="browser-warnings">
        <h3>브라우저별 보안 경고 현황</h3>
        <div class="browser-grid">
            <div class="browser-item browser-warning">
                <div class="browser-icon">🟡</div>
                <div class="browser-info">
                    <h4>Chrome</h4>
                    <p class="browser-status">"이 연결은 비공개 연결이 아닙니다"</p>
                    <div class="browser-detail">NET::ERR_CERT_AUTHORITY_INVALID 오류</div>
                    <div class="user-action">"고급" → "안전하지 않은 사이트로 이동" 클릭 필요</div>
                </div>
            </div>
            
            <div class="browser-item browser-warning">
                <div class="browser-icon">⚠️</div>
                <div class="browser-info">
                    <h4>Firefox</h4>
                    <p class="browser-status">"보안 연결 실패"</p>
                    <div class="browser-detail">SEC_ERROR_UNKNOWN_ISSUER</div>
                    <div class="user-action">"고급..." → "위험을 감수하고 계속" 필요</div>
                </div>
            </div>
            
            <div class="browser-item browser-warning">
                <div class="browser-icon">🔒</div>
                <div class="browser-info">
                    <h4>Safari</h4>
                    <p class="browser-status">"이 연결은 안전하지 않습니다"</p>
                    <div class="browser-detail">인증서 신뢰 설정 필요</div>
                    <div class="user-action">"세부사항 보기" → "웹사이트 방문" 필요</div>
                </div>
            </div>
            
            <div class="browser-item browser-warning">
                <div class="browser-icon">🛡️</div>
                <div class="browser-info">
                    <h4>Edge</h4>
                    <p class="browser-status">"이 사이트는 안전하지 않습니다"</p>
                    <div class="browser-detail">SmartScreen 필터 작동</div>
                    <div class="user-action">복잡한 우회 절차 필요</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 모바일 환경 특별 영향 -->
    <div class="mobile-impact">
        <h3>📱 모바일 환경 특별 영향</h3>
        <div class="mobile-analysis">
            <div class="mobile-issue severe">
                <h4>모바일 브라우저에서 더 엄격한 차단</h4>
                <div class="mobile-details">
                    <div class="mobile-item">
                        <strong>iOS Safari:</strong> 매우 강력한 보안 경고, 우회 접속 매우 어려움
                    </div>
                    <div class="mobile-item">
                        <strong>Android Chrome:</strong> "연결이 비공개 설정이 아님" 강력 경고
                    </div>
                    <div class="mobile-item">
                        <strong>모바일 트래픽 손실:</strong> 데스크탑 대비 {{ mobile_additional_loss }}% 추가 손실
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 보안 점수 세부 분석 -->
    <div class="security-score-breakdown">
        <h3>📊 보안 점수 세부 분석</h3>
        <div class="score-breakdown">
            <div class="score-category">
                <div class="category-name">SSL/TLS 인증서</div>
                <div class="category-progress">
                    <div class="progress-bar">
                        <div class="progress-fill warning" style="width: {{ (ssl_score / 40 * 100)|round }}%"></div>
                    </div>
                </div>
                <div class="category-score">{{ ssl_score }}/40</div>
                <div class="category-detail">자체 서명으로 기본 점수만 획득</div>
            </div>
            
            <div class="score-category">
                <div class="category-name">보안 헤더</div>
                <div class="category-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ (headers_score / 20 * 100)|round }}%"></div>
                    </div>
                </div>
                <div class="category-score">{{ headers_score }}/20</div>
                <div class="category-detail">{{ headers_present }}개 헤더 설정됨</div>
            </div>
            
            <div class="score-category">
                <div class="category-name">프로토콜 지원</div>
                <div class="category-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ (protocol_score / 15 * 100)|round }}%"></div>
                    </div>
                </div>
                <div class="category-score">{{ protocol_score }}/15</div>
                <div class="category-detail">{{ protocol_detail }}</div>
            </div>
            
            <div class="score-category">
                <div class="category-name">암호화 강도</div>
                <div class="category-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ (cipher_score / 25 * 100)|round }}%"></div>
                    </div>
                </div>
                <div class="category-score">{{ cipher_score }}/25</div>
                <div class="category-detail">기본 암호화 적용</div>
            </div>
            
            <div class="score-total">
                <div class="total-label">총 보안 점수</div>
                <div class="total-score">{{ total_score }}/100</div>
                <div class="total-grade grade-{{ grade_class }}">{{ security_grade }}</div>
            </div>
        </div>
        
        <div class="improvement-potential">
            <h4>개선 가능성</h4>
            <p>Let's Encrypt 적용 시: <strong>{{ total_score }}점 → {{ improved_score }}점 ({{ improvement_points }}점 향상)</strong></p>
            <p>보안 등급: <strong>{{ security_grade }} → {{ improved_grade }}</strong></p>
        </div>
    </div>
</section>
{% endblock %}

{% block business_impact %}
{% include "components/business_impact.html" %}
{% endblock %}

{% block solutions %}
<section class="solutions">
    <h2>🔧 해결 방안 및 구현 가이드</h2>
    
    {% if has_server_error %}
    <!-- Phase 0: 긴급 서버 수정 -->
    <div class="solution-phase phase-emergency">
        <div class="phase-header emergency">
            <h3>🚨 Phase 0: 긴급 서버 오류 수정</h3>
            <div class="phase-meta">
                <span class="duration">소요시간: 1-3시간</span>
                <span class="priority">최우선</span>
                <span class="deadline">즉시 실행</span>
            </div>
        </div>
        
        <div class="phase-content">
            <div class="emergency-notice">
                <p><strong>⚠️ 중요:</strong> SSL 인증서 교체 전에 서버 오류를 먼저 수정해야 합니다.</p>
            </div>
            
            {% if http_status_code == 406 %}
            <h4>406 Not Acceptable 오류 해결</h4>
            <div class="server-fix-steps">
                <div class="fix-step">
                    <h5>1. nginx 프록시 설정 수정</h5>
                    <div class="code-block">
                        <pre><code># /etc/nginx/sites-available/{{ domain }}
server {
    listen 443 ssl;
    server_name {{ domain }};
    
    # 현재 자체서명 인증서 임시 유지
    ssl_certificate {{ current_cert_path }};
    ssl_certificate_key {{ current_key_path }};
    
    location / {
        # Accept 헤더 제대로 전달
        proxy_set_header Accept $http_accept;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        proxy_pass http://localhost:{{ backend_port | default('8080') }};
    }
    
    # 406 오류 임시 우회 (테스트용)
    error_page 406 = @handle406;
    location @handle406 {
        add_header Content-Type text/html;
        return 200 "Service available - SSL certificate will be updated soon";
    }
}</code></pre>
                    </div>
                </div>
                
                <div class="fix-step">
                    <h5>2. 설정 테스트 및 적용</h5>
                    <div class="code-block">
                        <pre><code># nginx 설정 테스트
sudo nginx -t

# 설정 적용
sudo systemctl reload nginx

# 즉시 테스트
curl -I https://{{ domain }}
# 예상 결과: HTTP/1.1 200 OK</code></pre>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="verification-steps">
                <h5>✅ 서버 수정 완료 확인</h5>
                <ul>
                    <li>HTTPS 접속시 200 OK 응답 확인</li>
                    <li>주요 페이지 정상 로딩 확인</li>
                    <li>양식 제출 기능 정상 작동 확인</li>
                </ul>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Phase 1: SSL 인증서 교체 -->
    <div class="solution-phase phase-critical">
        <div class="phase-header">
            <h3>🔒 Phase 1: 정식 SSL 인증서 교체</h3>
            <div class="phase-meta">
                <span class="duration">소요시간: 1-2시간</span>
                <span class="cost">비용: ₩0 (Let's Encrypt)</span>
                <span class="deadline">{{ '2-3일' if has_server_error else '당일' }} 완료</span>
            </div>
        </div>
        
        <div class="phase-content">
            <h4>자체 서명 → Let's Encrypt 정식 인증서 교체</h4>
            
            <div class="replacement-steps">
                <div class="replacement-step">
                    <h5>1. 기존 인증서 백업</h5>
                    <div class="code-block">
                        <pre><code># 현재 인증서 위치 확인
sudo find /etc -name "*.crt" -o -name "*.pem" | grep {{ domain }}

# 백업 디렉토리 생성 및 백업
sudo mkdir -p /backup/ssl_old/
sudo cp {{ current_cert_path }} /backup/ssl_old/
sudo cp {{ current_key_path }} /backup/ssl_old/</code></pre>
                    </div>
                </div>
                
                <div class="replacement-step">
                    <h5>2. Let's Encrypt 인증서 발급</h5>
                    <div class="code-block">
                        {% if web_server_type == 'nginx' %}
                        <pre><code># Nginx 자동 설정 (기존 설정 자동 교체)
sudo certbot --nginx -d {{ domain }}

# 확인사항:
# - 이메일 입력 (갱신 알림용)
# - 이용약관 동의
# - HTTP → HTTPS 리다이렉션 설정 (Yes 선택)</code></pre>
                        {% else %}
                        <pre><code># 수동 발급 후 설정 교체
sudo certbot certonly --webroot -w /var/www/html -d {{ domain }}

# 웹서버 설정 수동 업데이트 필요</code></pre>
                        {% endif %}
                    </div>
                </div>
                
                <div class="replacement-step">
                    <h5>3. 설정 검증 및 서비스 재시작</h5>
                    <div class="code-block">
                        <pre><code># 웹서버 설정 테스트
sudo {{ web_server_type }} -t

# 서비스 재시작
sudo systemctl reload {{ web_server_type }}

# SSL 인증서 확인
echo | openssl s_client -connect {{ domain }}:443 | openssl x509 -noout -issuer
# 예상 결과: issuer=C=US, O=Let's Encrypt, CN=R3</code></pre>
                    </div>
                </div>
            </div>
            
            <div class="expected-results">
                <h4>✅ 교체 완료 후 즉시 효과</h4>
                <div class="results-grid">
                    <div class="result-item immediate">
                        <strong>브라우저 신뢰:</strong> 모든 브라우저에서 🔒 자물쇠 아이콘 표시
                    </div>
                    <div class="result-item immediate">
                        <strong>보안 경고 제거:</strong> "비공개 연결이 아님" 경고 완전 사라짐
                    </div>
                    <div class="result-item immediate">
                        <strong>SSL Labs 등급:</strong> D등급 → B+등급 ({{ ssl_grade_improvement }}점 향상)
                    </div>
                    <div class="result-item immediate">
                        <strong>사용자 경험:</strong> 복잡한 우회 절차 없이 바로 접속 가능
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Phase 2: 보안 강화 -->
    <div class="solution-phase phase-important">
        <div class="phase-header">
            <h3>⭐ Phase 2: 종합 보안 강화</h3>
            <div class="phase-meta">
                <span class="duration">소요시간: 2-3일</span>
                <span class="cost">비용: ₩0</span>
                <span class="deadline">1주일 이내</span>
            </div>
        </div>
        
        <div class="phase-content">
            <h4>SSL Labs A등급 달성 및 완전한 HTTPS 전환</h4>
            
            <div class="advanced-config">
                <div class="config-section">
                    <h5>1. 고급 SSL/TLS 설정</h5>
                    <div class="code-block">
                        {% if web_server_type == 'nginx' %}
                        <pre><code>server {
    listen 443 ssl http2;
    server_name {{ domain }};
    
    ssl_certificate /etc/letsencrypt/live/{{ domain }}/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/{{ domain }}/privkey.pem;
    
    # 고급 SSL 설정 (A등급 달성)
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # OCSP Stapling (A+ 등급용)
    ssl_stapling on;
    ssl_stapling_verify on;
    ssl_trusted_certificate /etc/letsencrypt/live/{{ domain }}/chain.pem;
    resolver 8.8.8.8 8.8.4.4 valid=300s;
    resolver_timeout 5s;
}</code></pre>
                        {% endif %}
                    </div>
                </div>
                
                <div class="config-section">
                    <h5>2. 필수 보안 헤더 설정</h5>
                    <div class="code-block">
                        <pre><code># 핵심 보안 헤더 (A등급 필수)
add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
add_header X-Frame-Options DENY always;
add_header X-Content-Type-Options nosniff always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# XSS 방지 (추가 보안)
add_header X-XSS-Protection "1; mode=block" always;

# Content Security Policy (고급)
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'" always;</code></pre>
                    </div>
                </div>
                
                <div class="config-section">
                    <h5>3. HTTP → HTTPS 완전 리다이렉션</h5>
                    <div class="code-block">
                        <pre><code>server {
    listen 80;
    server_name {{ domain }};
    
    # 모든 HTTP 요청을 HTTPS로 영구 리다이렉션
    return 301 https://$server_name$request_uri;
}</code></pre>
                    </div>
                </div>
            </div>
            
            <div class="expected-results">
                <h4>✅ 1주일 완료 후 효과</h4>
                <div class="results-grid">
                    <div class="result-item weekly">
                        <strong>SSL Labs A등급:</strong> 업계 최고 수준 보안 달성
                    </div>
                    <div class="result-item weekly">
                        <strong>완전한 HTTPS:</strong> HTTP 접속 자동 리다이렉션
                    </div>
                    <div class="result-item weekly">
                        <strong>SEO 개선:</strong> Google 순위 상승 시작
                    </div>
                    <div class="result-item weekly">
                        <strong>매출 회복:</strong> 월 {{ format_currency(full_monthly_recovery) }} 회복
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ROI 분석 -->
    <div class="roi-analysis">
        <h3>💰 투자 대비 효과 (ROI)</h3>
        <div class="roi-calculation">
            <div class="roi-metrics">
                <div class="roi-item">
                    <div class="roi-label">총 투자 비용</div>
                    <div class="roi-value">₩0</div>
                    <div class="roi-detail">(Let's Encrypt 무료)</div>
                </div>
                <div class="roi-item">
                    <div class="roi-label">연간 매출 회복</div>
                    <div class="roi-value highlight">{{ format_currency(annual_recovery) }}</div>
                    <div class="roi-detail">즉시 효과 발생</div>
                </div>
                <div class="roi-item">
                    <div class="roi-label">ROI</div>
                    <div class="roi-value infinite">∞%</div>
                    <div class="roi-detail">(투자 0원, 수익 무한대)</div>
                </div>
            </div>
            
            <div class="roi-comparison">
                <h4>다른 해결책 대비 우위</h4>
                <div class="comparison-options">
                    <div class="option current">
                        <strong>Let's Encrypt (권장):</strong> ₩0, 당일 완료, A등급 달성 가능
                    </div>
                    <div class="option alternative">
                        <strong>상용 SSL:</strong> ₩10-50만원/년, 복잡한 절차, 동일한 보안 수준
                    </div>
                    <div class="option alternative">
                        <strong>클라우드 서비스:</strong> ₩20-100만원/년, 추가 종속성, 복잡한 설정
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block action_plan %}
<section class="action-plan">
    <h2>⚡ 즉시 실행 가이드</h2>
    
    <div class="execution-timeline">
        <h3>🕒 실행 타임라인 ({{ '3-6시간' if has_server_error else '2-4시간' }})</h3>
        
        <div class="timeline-container">
            {% if has_server_error %}
            <div class="timeline-item urgent">
                <div class="timeline-time">0-2시간</div>
                <div class="timeline-content">
                    <h4>🚨 서버 오류 수정 (최우선)</h4>
                    <ul>
                        <li>nginx/Apache 설정 파일 수정</li>
                        <li>Accept 헤더 처리 개선</li>
                        <li>HTTPS 응답 200 OK 확인</li>
                    </ul>
                </div>
            </div>
            {% endif %}
            
            <div class="timeline-item critical">
                <div class="timeline-time">{{ '2-4시간' if has_server_error else '0-2시간' }}</div>
                <div class="timeline-content">
                    <h4>🔒 SSL 인증서 교체</h4>
                    <ul>
                        <li>Let's Encrypt Certbot 설치</li>
                        <li>자체서명 → 정식 인증서 교체</li>
                        <li>자동 갱신 설정</li>
                    </ul>
                </div>
            </div>
            
            <div class="timeline-item important">
                <div class="timeline-time">{{ '4-6시간' if has_server_error else '2-4시간' }}</div>
                <div class="timeline-content">
                    <h4>⭐ 보안 강화 설정</h4>
                    <ul>
                        <li>보안 헤더 적용</li>
                        <li>HTTPS 리다이렉션</li>
                        <li>SSL Labs A등급 달성</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="success-metrics">
        <h3>📊 성공 지표 (완료 후 즉시 측정)</h3>
        <div class="success-checklist">
            <div class="success-item">
                <strong>✅ 기술적 성공:</strong>
                <ul>
                    <li>모든 브라우저에서 🔒 아이콘 표시</li>
                    <li>SSL Labs B+ 이상 등급</li>
                    <li>HTTPS 접속 200 OK 응답</li>
                </ul>
            </div>
            
            <div class="success-item">
                <strong>📈 비즈니스 성공:</strong>
                <ul>
                    <li>당일 트래픽 30% 증가</li>
                    <li>브라우저 경고로 인한 이탈 제거</li>
                    <li>브랜드 이미지 즉시 개선</li>
                </ul>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block conclusion %}
<section class="conclusion">
    <h2>🎯 최종 결론 및 권고</h2>
    
    <div class="conclusion-summary">
        <div class="current-crisis">
            <h3>현재 상황: {{ '이중 보안 위기' if has_server_error else '보안 신뢰도 위기' }}</h3>
            <p><strong>{{ domain }}</strong>의 자체 서명 인증서{% if has_server_error %} + 서버 오류 문제{% endif %}는 
               고객 신뢰와 비즈니스 성과에 심각한 악영향을 미치고 있습니다.</p>
            
            {% if has_server_error %}
            <div class="crisis-severity">
                <p><strong>⚠️ 특히 심각한 점:</strong></p>
                <ul>
                    <li>자체 서명으로 인한 브라우저 경고</li>
                    <li>{{ http_status_code }} 서버 오류로 HTTPS 서비스 중단</li>
                    <li>이중 문제로 고객 신뢰도 치명타</li>
                    <li>기술력 의심으로 B2B 비즈니스 타격</li>
                </ul>
            </div>
            {% endif %}
        </div>
        
        <div class="solution-confidence">
            <h3>해결책: 확실하고 즉시 가능</h3>
            <div class="confidence-factors">
                <div class="confidence-item">
                    <strong>💰 비용:</strong> 완전 무료 (Let's Encrypt)
                </div>
                <div class="confidence-item">
                    <strong>⏰ 시간:</strong> {{ '하루' if has_server_error else '반나절' }} 완료
                </div>
                <div class="confidence-item">
                    <strong>🎯 효과:</strong> 즉시 확인 가능 (당일 트래픽 회복)
                </div>
                <div class="confidence-item">
                    <strong>⚠️ 위험:</strong> 매우 낮음 (백업 + 테스트)
                </div>
            </div>
        </div>
    </div>

    <div class="final-recommendation">
        <div class="recommendation-box">
            <h3>🚀 최종 권고사항</h3>
            
            <div class="recommendation-priority">
                <div class="priority-item critical">
                    <h4>1. 즉시 실행 (오늘)</h4>
                    <p>{% if has_server_error %}서버 오류 수정 → {% endif %}Let's Encrypt SSL 교체로 핵심 문제 해결</p>
                    <div class="expected-outcome">당일 저녁: 🔒 모든 브라우저에서 안전한 연결 확인</div>
                </div>
                
                <div class="priority-item high">
                    <h4>2. 보안 강화 (1주일)</h4>
                    <p>A등급 달성 및 보안 헤더 적용으로 업계 최고 수준 보안 구축</p>
                    <div class="expected-outcome">1주일 후: 월 {{ format_currency(monthly_recovery) }} 매출 회복</div>
                </div>
                
                <div class="priority-item medium">
                    <h4>3. 지속 관리 (매월)</h4>
                    <p>자동 갱신 모니터링 및 보안 수준 유지로 장기 안정성 확보</p>
                    <div class="expected-outcome">장기적: 연 {{ format_currency(annual_recovery) }} 매출 기여</div>
                </div>
            </div>
            
            <div class="final-message">
                <p><strong>"{{ domain }}이 자체 서명 인증서를 사용한다는 것은 2025년 기준으로 고객에게 '우리는 보안에 신경쓰지 않습니다'라고 말하는 것과 같습니다."</strong></p>
                
                <p><strong>하지만 다행히 해결책은 간단합니다:</strong></p>
                <ul>
                    <li>✅ 완전 무료로 해결 가능</li>
                    <li>✅ {{ '하루' if has_server_error else '반나절' }}면 충분</li>
                    <li>✅ 즉시 효과 확인 가능</li>
                    <li>✅ 경쟁사 대비 우위 확보</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="action-commitment">
        <h3>📅 실행 약속</h3>
        <div class="commitment-table">
            <div class="commitment-row">
                <span class="commitment-time">오늘 {{ current_time }} 이후 4시간</span>
                <span class="commitment-goal">🔒 HTTPS 정상 서비스 시작</span>
            </div>
            <div class="commitment-row">
                <span class="commitment-time">내일 이시간</span>
                <span class="commitment-goal">📈 트래픽 회복 효과 확인</span>
            </div>
            <div class="commitment-row">
                <span class="commitment-time">1주일 후</span>
                <span class="commitment-goal">🏆 SSL Labs A등급 달성</span>
            </div>
            <div class="commitment-row highlight">
                <span class="commitment-time">1개월 후</span>
                <span class="commitment-goal">💰 월 매출 {{ format_currency(monthly_recovery) }} 회복 달성</span>
            </div>
        </div>
    </div>
</section>
{% endblock %}